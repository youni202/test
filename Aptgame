import React, { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from "@/components/ui/dialog";

const ApartmentGame = () => {
  const [currentFloor, setCurrentFloor] = useState(0);
  const [gameStarted, setGameStarted] = useState(false);
  const [showPenalty, setShowPenalty] = useState(false);
  const [timeLeft, setTimeLeft] = useState(5);
  const [gameOver, setGameOver] = useState(false);
  const [score, setScore] = useState(0);

  const floorNames = {
    '-2': 'ì§€í•˜ 2ì¸µ',
    '-1': 'ì§€í•˜ 1ì¸µ',
    0: '1ì¸µ',
    1: '2ì¸µ',
    2: '3ì¸µ',
    3: '4ì¸µ',
    4: '5ì¸µ',
    5: 'ì˜¥ìƒ',
    6: 'í—¬ê¸°ì¥'
  };

  useEffect(() => {
    let timer;
    if (gameStarted && !gameOver && !showPenalty) {
      timer = setInterval(() => {
        setTimeLeft((prev) => {
          if (prev <= 1) {
            setShowPenalty(true);
            return 5;
          }
          return prev - 1;
        });
      }, 1000);
    }
    return () => clearInterval(timer);
  }, [gameStarted, gameOver, showPenalty]);

  const handleFloorSelect = (floor) => {
    if (!gameStarted || gameOver) return;

    const validMoves = getValidMoves(currentFloor);
    if (validMoves.includes(floor)) {
      setCurrentFloor(floor);
      setTimeLeft(5);
      setScore(score + 1);
    } else {
      setShowPenalty(true);
    }
  };

  const getValidMoves = (current) => {
    let moves = [];
    if (current > -2) moves.push(current - 1);
    if (current < 6) moves.push(current + 1);
    if (current === 5) moves.push(6);
    return moves;
  };

  const startGame = () => {
    setGameStarted(true);
    setGameOver(false);
    setCurrentFloor(0);
    setScore(0);
    setTimeLeft(5);
    setShowPenalty(false);
  };

  const handlePenalty = () => {
    setShowPenalty(false);
    setGameOver(true);
  };

  return (
    <div className="min-h-screen bg-gray-100 p-4 flex items-center justify-center">
      <Card className="w-full max-w-lg p-6 bg-white shadow-xl rounded-xl">
        <div className="text-center mb-6">
          <h1 className="text-2xl font-bold text-gray-800 mb-2">ì•„íŒŒíŠ¸ ê²Œì„</h1>
          {!gameStarted ? (
            <div className="text-center space-y-4">
              <p className="text-gray-600 mb-4">
                ì¸µì„ ì´ë™í•˜ë©´ì„œ ìµœëŒ€í•œ ë§ì€ ì ìˆ˜ë¥¼ íšë“í•˜ì„¸ìš”!
                ì œí•œ ì‹œê°„ ì•ˆì— ì´ë™í•´ì•¼ í•©ë‹ˆë‹¤.
              </p>
              <Button 
                onClick={startGame}
                className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg"
              >
                ê²Œì„ ì‹œì‘
              </Button>
            </div>
          ) : (
            <div className="space-y-6">
              <div className="grid grid-cols-3 gap-4 text-center mb-4">
                <div className="bg-blue-100 p-2 rounded">
                  <div className="text-sm text-gray-600">í˜„ì¬ ì¸µ</div>
                  <div className="text-xl font-bold text-blue-600">
                    {floorNames[currentFloor]}
                  </div>
                </div>
                <div className="bg-yellow-100 p-2 rounded">
                  <div className="text-sm text-gray-600">ë‚¨ì€ ì‹œê°„</div>
                  <div className="text-xl font-bold text-yellow-600">
                    {timeLeft}ì´ˆ
                  </div>
                </div>
                <div className="bg-green-100 p-2 rounded">
                  <div className="text-sm text-gray-600">ì ìˆ˜</div>
                  <div className="text-xl font-bold text-green-600">
                    {score}ì 
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-3 gap-2">
                {Object.entries(floorNames).map(([floor, name]) => (
                  <Button
                    key={floor}
                    onClick={() => handleFloorSelect(parseInt(floor))}
                    className={`p-4 ${
                      parseInt(floor) === currentFloor
                        ? 'bg-blue-500 text-white'
                        : getValidMoves(currentFloor).includes(parseInt(floor))
                        ? 'bg-green-500 hover:bg-green-600 text-white'
                        : 'bg-gray-200 text-gray-400'
                    }`}
                    disabled={!getValidMoves(currentFloor).includes(parseInt(floor))}
                  >
                    {name}
                  </Button>
                ))}
              </div>
            </div>
          )}
        </div>

        <Dialog open={showPenalty} onOpenChange={() => setShowPenalty(false)}>
          <DialogContent>
            <DialogHeader>
              <DialogTitle>ë²Œì¹™!</DialogTitle>
              <DialogDescription>
                {timeLeft <= 0 ? 'ì‹œê°„ ì´ˆê³¼!' : 'ì˜ëª»ëœ ì´ë™!'} 
                ë²Œì¹™ìœ¼ë¡œ í•œ ì” ë§ˆì‹œì„¸ìš”! ğŸº
              </DialogDescription>
            </DialogHeader>
            <DialogFooter>
              <Button onClick={handlePenalty}>í™•ì¸</Button>
            </DialogFooter>
          </DialogContent>
        </Dialog>

        {gameOver && (
          <Dialog open={gameOver} onOpenChange={() => setGameOver(false)}>
            <DialogContent>
              <DialogHeader>
                <DialogTitle>ê²Œì„ ì¢…ë£Œ!</DialogTitle>
                <DialogDescription>
                  ìµœì¢… ì ìˆ˜: {score}ì 
                </DialogDescription>
              </DialogHeader>
              <DialogFooter>
                <Button onClick={startGame}>ë‹¤ì‹œ ì‹œì‘</Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>
        )}
      </Card>
    </div>
  );
};

export default ApartmentGame;
